<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0" />
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <title>折线统计图</title>
    </head>

    <style type="text/css">
        .line{
            fill: none;
            stroke: #ffab00;
            stroke-width: 3;
        }

        .line2{
            fill: none;
            stroke: #00e1ff;
            stroke-width: 3;
        }

        .overlay{
            fill: none;
            pointer-events: all;
        }

        .dot{
            fill: #ffab00;
            stroke: #fff;
        }

        .focus circle{
            fill: none;
            stroke: steelblue;
        }

    </style>
    <body>
    </body>
</html>

<script>
    var margin = {top:50,right:50,bottom:50,left:100},
        width = 1500 - margin.left - margin.right,
        height = 700 - margin.top - margin.bottom;

    var svg = d3.select("body").append("svg")
            .attr("width",width + margin.left + margin.right)
            .attr("height",height + margin.bottom + margin.top)
            .append("g")
            .attr("transform","translate("+ margin.left + "," + margin.right +")");

d3.csv("./assets/data/us-states.csv").then(function(data)
{
    let newdata = data.filter(d => d.state == 'Washington');
    newdata = newdata.filter(d => d.date <= '2020-08-21' && d.date >= '2020-06-21');
    var xScale = d3.scalePoint()
            .domain(newdata.map(d => d.date))
            .range([0,width]);
    
    var yScale = d3.scaleLinear()
            //.domain(d3.extent(newdata,d => d.cases_avg_per_100k))
            //.domain([5,d3.max(newdata,d => d.cases_avg_per_100k)])
            .domain([5,13])
            .range([height,0]);

    var yScale2 = d3.scaleLinear()
            .domain(d3.extent(newdata,d => d.deaths_avg_per_100k))
            .range([height,0]);

    var line = d3.line()
        .x(function(d) { return xScale(d.date);})
        .y(function(d) { return yScale(d.cases_avg_per_100k);})
        .curve(d3.curveMonotoneX);

    var line2 = d3.line()
        .x(function(d) { return xScale(d.date);})
        .y(function(d) { return yScale2(d.deaths_avg_per_100k);})
        .curve(d3.curveMonotoneX);

    svg.append("path")
        .datum(newdata)
        .attr("class","line")
        .attr("d",line);

    // svg.append("path")
    //     .datum(newdata)
    //     .attr("class","line2")
    //     .attr("d",line2);

    svg.append("g")
        .attr("class","x axis")
        .attr("transform","translate(0," + height + ")")
        .call(d3
            .axisBottom(xScale)
            .tickFormat(function(d){
                if(d.indexOf("-21")==-1)
                {
                    return ;
                }
                else
                return d;
            })
            .ticks(30))
        .selectAll("text")
        .attr("dy","1.75em")
        .attr("transform","rotate(-14)")
        .append("text")
        .attr("y",height - 70)
        .attr("x",width + 10)
        .attr("text-anchor","end")
        .attr("stroke","black")
        .text("Date");

    svg.append("g")
        .attr("class","y axis1")
        .call(d3.axisLeft(yScale))
        .append("text")
        .attr("y",50)
        .attr("x",0)
        .attr("dy","-5.1em")
        .attr("text-anchor","end")
        .attr("stroke","black")
        .text("Cases Avg Per 100k");

    // svg.append("g")
    //     .attr("class","y axis2")
    //     .call(d3.axisRight(yScale2))
    //     .append("text")
    //     .attr("y",50)
    //     .attr("x",70)
    //     .attr("dy","-5.1em")
    //     .attr("text-anchor","end")
    //     .attr("stroke","black")
    //     .text("Total Deaths");
});
    
</script>
